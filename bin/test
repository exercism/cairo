#!/usr/bin/env bash

# Synopsis:
# Test the student's solution.

# Example: test two-fer
# ./bin/test two-fer

set -eo pipefail

repo=$(git rev-parse --show-toplevel)

if (( "$#" != 1 )); then
    echo "Error: Incorrect number of arguments. This script requires exactly one argument."
    echo "Expected: './bin/test <exercise-slug>'"
    exit 1
fi
    
slug="$1"

if [[ -d "$repo/exercises/concept/$slug" ]]; then
    exercise_path="$repo/exercises/concept/$slug"
elif [[ -d "$repo/exercises/practice/$slug" ]]; then
    exercise_path="$repo/exercises/practice/$slug"
else
    echo "No such exercise: $slug"
    exit 1
fi

# Exercism sets a timeout limit for tests
timeout 20 scarb --manifest-path "$exercise_path/Scarb.toml" cairo-test --include-ignored --test-kind integration || { echo "$slug timed out"; exit 1; }
